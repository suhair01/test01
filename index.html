<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Arena DEX Token Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: sans-serif;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      background: #1f1f1f;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 0 16px rgba(0, 0, 0, 0.5);
    }
    h2 { text-align: center; color: #00c2ff; }
    select, button {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      background-color: #00c2ff;
      color: white;
      cursor: pointer;
    }
    #walletStatus {
      margin-top: 10px;
      text-align: center;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸŒ€ Arena DEX - Tokens</h2>
    
    <button onclick="connect()">Connect Wallet</button>
    <p id="walletStatus">Not connected</p>

    <label>From Token:</label>
    <select id="tokenInSelect"></select>

    <label>To Token:</label>
    <select id="tokenOutSelect"></select>
  </div>

  <script>
    const FACTORY = "0xB9794E1BF5D79cD851a38024752DfF800B6b1cE1";
    const FACTORY_ABI = [
      "function allPairsLength() external view returns (uint256)",
      "function allPairs(uint256) external view returns (address)"
    ];
    const PAIR_ABI = [
      "function token0() external view returns (address)",
      "function token1() external view returns (address)"
    ];
    const ERC20_ABI = [
      "function symbol() view returns (string)",
      "function name() view returns (string)"
    ];

    let provider, signer;

    async function connect() {
      if (!window.ethereum) return alert("Please install MetaMask");
      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletStatus").innerText = `Connected: ${address}`;
      await fetchTokensFromFactory();
    }

    async function fetchTokensFromFactory() {
      const factory = new ethers.Contract(FACTORY, FACTORY_ABI, provider);
      const length = await factory.allPairsLength();
      const tokenMap = {};

      for (let i = 0; i < length; i++) {
        try {
          const pairAddress = await factory.allPairs(i);
          const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
          const [token0, token1] = await Promise.all([
            pair.token0(),
            pair.token1()
          ]);

          for (let token of [token0, token1]) {
            if (!tokenMap[token]) {
              try {
                const tokenContract = new ethers.Contract(token, ERC20_ABI, provider);
                const [symbol, name] = await Promise.all([
                  tokenContract.symbol(),
                  tokenContract.name()
                ]);
                tokenMap[token] = { address: token, symbol, name };
              } catch (e) { /* skip errors */ }
            }
          }
        } catch (e) { continue; }
      }

      populateDropdowns(Object.values(tokenMap));
    }

    function populateDropdowns(tokens) {
      const inSelect = document.getElementById("tokenInSelect");
      const outSelect = document.getElementById("tokenOutSelect");
      inSelect.innerHTML = outSelect.innerHTML = "";

      tokens.forEach(t => {
        const option = new Option(`${t.symbol} (${t.name})`, t.address);
        inSelect.add(option.cloneNode(true));
        outSelect.add(option.cloneNode(true));
      });
    }
  </script>
</body>
</html>

